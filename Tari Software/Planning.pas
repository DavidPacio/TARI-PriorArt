ªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªª    procedure AComboBox1Exit(Sender: TObject);
    procedure AComboBox2Exit(Sender: TObject);
    procedure PlanGetInvoicesBtnClick(Sender: TObject);
    procedure PlanWizardPage4Enter(Sender: TObject);
    procedure PlanWizardPage4Exit(Sender: TObject);
    procedure HelpProdFTEBtnClick(Sender: TObject);
    procedure HelpTotalFteBtnClick(Sender: TObject);
    procedure HelpPotentialHoursBtnClick(Sender: TObject);
    procedure HelpPotentialUnitsBtnClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure wwDBNavigator1InsertUpdateState(Navigator: TwwDBNavigator;
      Button: TwwNavButton; Cause: TwwUpdateCause);
    procedure OvcTable3EndEdit(Sender: TObject;
      Cell: TOvcTableCellAncestor; RowNum, ColNum: Integer;
      var AllowIt: Boolean);
    procedure PlanExtBtnClick(Sender: TObject);
    procedure PlanningEndDateChange(Sender: TObject);
//    procedure HelpActualHoursBtnClick(Sender: TObject);
    procedure RGSceneClick(Sender: TObject);
    procedure PastProdExit(Sender: TObject);
    procedure PastPotUnitsExit(Sender: TObject);
    procedure WIChangeProductivityExit(Sender: TObject);
    procedure PlanPotUnitsExit(Sender: TObject);
    procedure fcImageBtn3Click(Sender: TObject);
    procedure PlanHelpPotentialHoursBtnClick(Sender: TObject);
    procedure PastInvoicesBnClick(Sender: TObject);
    procedure WorkBackBtnClick(Sender: TObject);
    procedure PlanningWizardChanging(Sender: TObject);
    procedure DBNavigator1Click(Sender: TObject; Button: TNavigateBtn);
    procedure DBNavigator1BeforeAction(Sender: TObject;
      Button: TNavigateBtn);
    procedure wwDBGrid1MouseMove(Sender: TObject; Shift: TShiftState; X,
      Y: Integer);
    procedure ActualDateStartExit(Sender: TObject);
    procedure ActualDateEndExit(Sender: TObject);
    procedure ActualDateStartDropDown(Sender: TObject);
    procedure DBEdit1Click(Sender: TObject);
    procedure OvcTable3KeyPress(Sender: TObject; var Key: Char);
    procedure OvcTable3KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure PlanningWizardKeyPress(Sender: TObject; var Key: Char);
    procedure OvcTable1KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure PlanWizardPage8DoneQuery(Sender: TObject; var Done: Boolean);
    procedure wwDBNavigator1InsertClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure wwDBEdit1Click(Sender: TObject);
    procedure wwDBNavigator1FirstUpdateState(Navigator: TwwDBNavigator;
      Button: TwwNavButton; Cause: TwwUpdateCause);
    procedure OvcTable2Exit(Sender: TObject);
    procedure OvcTable2DoneEdit(Sender: TObject; RowNum, ColNum: Integer);
    procedure TargetDetailsBtnClick(Sender: TObject);    {  Application.CreateForm(THelpPotentialHoursF, HelpPotentialHoursF);
  HelpPotentialHoursF.showmodal;
  if HelpPotentialHoursF.UserSelected <> 0 then
    PastPotUnits.value := PastFTEProduction.value * HelpPotentialHoursF.UserSelected;
  if UnitRounding = 0 then PastPotUnits.value := Round(PastPotUnits.value);
  HelpPotentialHoursF.Release;
}
  private
    PageChanging: boolean;
    DownArrow: boolean;
    DetailedIndex: integer;
    Initialised: Boolean;
    WhatifUpdate: boolean;
    CurrentScene: Integer;
    { Private declarations }
    procedure calculateSummary(activerow, activecol : integer);
    procedure setlabels;
    procedure setlabels1;
    procedure setlabels2;
    procedure getpastactivitybalances;
    procedure getplanactivitybalances;
    procedure setpastactivitybalances;
    procedure setplanactivitybalances;
    procedure CalculatePastActivity (accountno : integer);
    procedure CalculatePlanActivity(accountno : integer);
    procedure CalcNetProfit;
    procedure getBase;
    procedure handlePastDates(var Msg : TMessage); message LoPastDatePeriods;
    function EnddateExists(Newdate : TDateTime): Boolean;
  public
    { Public declarations }
  protected
  end;

var
  PlanningF: TPlanningF;
  TargetExpTotal : Currency;
  tabpress : boolean;

implementation

{$R *.DFM}

Uses DataCollector, AMiscFunctions, DIYPlanExpenses, Invoices,
     workback, Whatif, HelpProdFte, HelpTotalFte, HelpPotentialHours,
     HelpPotentialUnits, HelpActualHours, detailTargets, detailExpenses;


procedure TPlanningF.PlanWizardPage1Enter(Sender: TObject);
begin
  DataModuleClient.PlanHandle := PlanningF.Handle;
  Initialised := False;
  tabpress := false;
  Caption := 'Targeting - ' + DataModuleClient.BusinessDetailsBusiness_Name.value;
  Label1.caption := 'Establishing Dates';
  if Datamoduleclient.DateRangers.RecordCount < 5 then
    wwDBNavigator1Insert.Enabled := True
  else
    wwDBNavigator1Insert.Enabled := False;
  InitialPlanStart := DataModuleClient.DepartmentsCurrentPlanStart.Value;
  InitialPlanEnd := DataModuleClient.DepartmentsCurrentPlanEnd.Value;
  if (Daysbetween(DataModuleClient.DepartmentsLatestPlandate.Value, DataModuleClient.DepartmentsFirstPlanDate.Value) <= 366) Then
    PlanExtBtn.Enabled := False;
end;

procedure TPlanningF.PlanningWizardFinishClick(Sender: TObject);
begin
  screen.Cursor := crHourGlass;
  Ovctable1.StopEditingState(true);
  Ovctable1.StartEditingState;
  OvcTable1.AllowRedraw := False;
  CalcNetProfit;
  if DataCollect.Planloaded = True then
    DataCollect.setPlanningData;
  DataCollect.ClearPlanDataList;
  DataCollect.ClearPlanExpDataList;
  DataCollect.ClearConsolidatedList;
  Close;
end;

procedure TPlanningF.OvcTable1DoneEdit(Sender: TObject; RowNum,
  ColNum: Integer);
begin
  if (RowNum  = 0) then exit;
  case ColNum Of
    colMarker,
    colTitle,
    colSubTitle,
    colPastBalPc,
    colPlanBalPc:  Exit;
    colPastBal,
    colPlanBal: ; //calculateFieldValues(RowNum, ColNum);
  end;

  // Update the grid with the new balances
  with OvcTable1
  do begin
    AllowRedraw := False;
    InvalidateTable;
    AllowRedraw := True;
  end;
end;

procedure TPlanningF.OvcTable1GetCellData(Sender: TObject; RowNum,
  ColNum: Integer; var Data: Pointer; Purpose: TOvcCellDataPurpose);
var
  PlanDataRec : TPlanDataRecPtr;
begin
  if (RowNum = 0) or (Colnum = 0) then exit;
  PlanDataRec := PlanDataList.Items[Rownum - 1];

  case ColNum Of

    colTitle:  Data := @PlanDataRec.AccountTitle;
    colSubTitle: Data := @PlanDataRec.AccountSubtitle;
    colPastBal:    Data := @PlanDataRec.PastBalances[DataModuleClient.DateRangersD_Index.value - 1];
    colPastBalpc:    Data := @PlanDataRec.PastResultPc;
    colPlanBal:   Data := @PlanDataRec.PlanTotal;
    colPlanBalPc:   Data := @PlanDataRec.PlanTotalPc;
  end;
end;

procedure TPlanningF.PlanWizardPage2Enter(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: Enter Page 2');
  // get data based on Dates selected on this page for Page 2
  Label1.caption := 'Past Profit and Loss Summary';
  SetPastdatelabels;
  AOvcTCCurrency1.NumericFormat := nfcomma;
  AOvcTCCurrency2.NumericFormat := nfPercent;
  OvcTable1.StartEditingState;
  screen.Cursor := crDefault;
end;

procedure TPlanningF.SetPastDateLabels;
begin
  fcLabel1.Caption := DataModuleClient.DateRangersStartDate.DisplayText + ' to ' +
    DataModuleClient.DateRangersEndDate.DisplayText;
  fcLabel5.Caption := fcLabel1.Caption;
  fcLabel7.Caption := fcLabel1.Caption;
  fcLabel3.Caption := fcLabel1.Caption;
end;
procedure TPlanningF.PlanWizardPage5Enter(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: Enter Page 5');
  // get data based on Dates selected on this page for Page 2
  Label1.caption := 'Target Profit and Loss Summary';
  if DataModuleClient.DateRangersStartDate.value <> 0
    then begin
    SetPastDateLabels;
    OvcTable2.Columns.Hidden[3] := False;
    OvcTable2.Columns.Hidden[4] := False;
    OvcTable2.width := 745;
    Label10.visible := True;
    fcLabel5.visible := True;
    Label30.left := 544;
    fcLabel6.left := 544;
    OvcTable2.InvalidateTable;
  end
  else begin
    OvcTable2.Columns.Hidden[3] := True;
    OvcTable2.Columns.Hidden[4] := True;
    OvcTable2.width := 548;
    Label10.visible := False;
    fcLabel5.visible := False;
    Label30.left := 347;
    fcLabel6.left := 347;
    OvcTable2.InvalidateTable;
  end;

  fcLabel6.Caption := DataModuleClient.DepartmentsCurrentPlanStart.DisplayText + ' to ' +
  DataModuleClient.DepartmentsCurrentPlanEnd.DisplayText;
  if DataCollect.Planloaded = false then
    DataCollect.getPlanningData;
  AOvcTCCurrency3.NumericFormat := nfcomma;
  AOvcTCCurrency4.NumericFormat := nfPercent;
  OvcTable1.StartEditingState;
end;

procedure TPlanningF.PlanWizardPage1Exit(Sender: TObject);
begin
  SelectedPastDate := DataModuleClient.DateRangersENDDATE.Value;
  DataModuleClient.Departments.edit;
  if (DataModuleClient.DepartmentsFirstPlanDate.value = 0)
    then DataModuleClient.DepartmentsFirstPlanDate.value :=
       DataModuleClient.DepartmentsCurrentPlanStart.value;
  if CompareDateTime(DataModuleClient.DepartmentsLatestPlanDate.Value, DataModuleClient.DepartmentsCurrentPlanEnd.Value) < 0 then
    DataModuleClient.DepartmentsLatestPlanDate.Value := DataModuleClient.DepartmentsCurrentPlanEnd.Value;
  if (CompareDateTime(DataModuleClient.DepartmentsCurrentPlanStart.Value, DataModuleClient.DepartmentsCurrentPlanEnd.Value) > 0) or
    (DaySpan(DataModuleClient.DepartmentsCurrentPlanStart.Value, DataModuleClient.DepartmentsCurrentPlanEnd.Value) > 366) then
    DataModuleClient.DepartmentsCurrentPlanEnd.Value := IncYear(DataModuleClient.DepartmentsCurrentPlanStart.Value, 1) - 1;
  DataModuleClient.Departments.Post;
  DataModuleClient.ClientDatabase.Refresh(True);
  FindPastDate;
  // refind selecetd date
  if DataModuleClient.DateRangersStartDate.value <> 0
    then begin
    PlanWizardPage2.PageIndex := 1;
    PlanWizardPage2.Include := True;
    PlanWizardPage3.PageIndex := 2;
    PlanWizardPage3.Include := True;
    PlanWizardPage4.PageIndex := 3;
    PlanWizardPage4.Include := True;
    PlanWizardPage7.PageIndex := 4;
    PlanWizardPage7.Include := True;
    PlanWizardPage5.PageIndex := 5;
    PlanWizardPage5.Include := True;
    PlanWizardPage6.PageIndex := 6;
    PlanWizardPage6.Include := True;
  end
  else begin
    PlanWizardPage5.PageIndex := 1;
    PlanWizardPage5.Include := True;
    PlanWizardPage3.PageIndex := 2;
    PlanWizardPage3.Include := True;
    PlanWizardPage6.PageIndex := 3;
    PlanWizardPage6.Include := True;
    PlanWizardPage7.PageIndex := 4;
    PlanWizardPage7.Include := True;
    PlanWizardPage2.PageIndex := 5;
    PlanWizardPage2.Include := False;
    PlanWizardPage4.PageIndex := 6;
    PlanWizardPage4.Include := False;
//    SpecialPage := True;
  end;
  DataModuleClient.DateRef.refresh;
end;

procedure TPlanningF.PlanWizardPage2Exit(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: Exit Page 2');
  OvcTable1.stopEditingState(True);
  DataCollect.ReloadPastBalances;
end;

procedure TPlanningF.PlanWizardPage5Exit(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: Exit Page 5');
  OvcTable2.stopEditingState(True);
end;

procedure TPlanningF.OvcTable1ActiveCellMoving(Sender: TObject;
  Command: Word; var RowNum, ColNum: Integer);
begin
  if RowNum = 0 then exit;

  // Make sure any pending edits are up to date, and get the current lines entries
  // if cell contents not legal, exit immediately, staying on the old active cell
  if not OvcTable1.SaveEditedData then begin
    RowNum := OvcTable1.ActiveRow;
    ColNum := OvcTable1.ActiveCol;
    exit;
  end;

   case Command of
    ccRight:
      with OvcTable1
      do begin
        if ((ColNum - 1) = colPastBal) // and tabpress
        then begin
          AllowRedraw := False;
          ColNum := colPlanBal;
          AllowRedraw := True;
        end
        else if ((ColNum - 1) = colPlanBal) // and tabpress
        then begin
          AllowRedraw := False;
          ColNum := colPastBal;
          AllowRedraw := True;
        end;
        StopEditingState(True);
        calculateSummary(activerow, activecol);
        StartEditingState;
      end;
    ccLeft:
      with OvcTable1
      do begin
        if (ColNum = colPastBal) and (RowNum > LockedRows)
        then begin
          AllowRedraw := False;
          ColNum := colPlanBal; // = last editable column
          dec(RowNum);
          AllowRedraw := True;
        end
        else if ColNum = colPlanbal
        then begin
          AllowRedraw := False;
          ColNum := colPastBal;
          AllowRedraw := True;
        end;
        StopEditingState(True);
        calculateSummary(activerow, activecol);
        StartEditingState;
      end;
    ccMouse:
      with OvcTable1
      do begin
        AllowRedraw := False;
        if (Colnum = ColTitle) or (Colnum = colSubTitle) then
          colNum := colPastBal;
        if ColNum = colPlanBalpc then
          ColNum := colPlanBal;
        if ColNum = colPastBalpc then
          ColNum := colPastBal;
        StopEditingState(True);
        calculateSummary(activerow, activecol);
        StartEditingState;
        AllowRedraw := True;
      end;
    ccDown:
      with OvcTable1
      do begin
        AllowRedraw := False;
        if RowNum < Rowlimit -1
        then begin
          StopEditingState(True);
          calculateSummary(activerow, activecol);
          IncRow(RowNum, 1);
          StartEditingState;
        end;
        AllowRedraw := True;
      End;
    ccUp:
      with OvcTable1
      do begin
        AllowRedraw := False;
        if RowNum > 1
        then begin
          StopEditingState(True);
          calculateSummary(activerow, activecol);
          IncRow(RowNum, -1);
          StartEditingState;
        end;
        AllowRedraw := True;
      End;
  end;
end;

procedure TPlanningF.OvcTable2ActiveCellMoving(Sender: TObject;
  Command: Word; var RowNum, ColNum: Integer);
begin
  if RowNum = 0 then exit;

  // Make sure any pending edits are up to date, and get the current lines entries
  // if cell contents not legal, exit immediately, staying on the old active cell
  if not OvcTable1.SaveEditedData then begin
    RowNum := OvcTable2.ActiveRow;
    ColNum := OvcTable2.ActiveCol;
    exit;
  end;

   case Command of
    ccRight:
      with OvcTable2
      do begin
        if ((ColNum - 1) = colPlanBal) // and tabpress
        then begin
          AllowRedraw := False;
          ColNum := colPlanBal;
          AllowRedraw := True;
        end
        else if ((ColNum - 1) = colPlanBal) // and tabpress
        then begin
          AllowRedraw := False;
          ColNum := colPlanBal;
          AllowRedraw := True;
        end;
        StopEditingState(True);
        calculateSummary(activerow, activecol);
        StartEditingState;
      end;
    ccLeft:
      with OvcTable2
      do begin
        if (ColNum = colPlanBal) and (RowNum > LockedRows)
        then begin
          AllowRedraw := False;
          ColNum := colPlanBal; // = last editable column
          dec(RowNum);
          AllowRedraw := True;
        end
        else if ColNum = colPlanbal
        then begin
          AllowRedraw := False;
          ColNum := colPlanBal;
          AllowRedraw := True;
        end;
        StopEditingState(True);
        calculateSummary(activerow, activecol);
        StartEditingState;
      end;
    ccMouse:
      with OvcTable2
      do begin
        AllowRedraw := False;
        if (colNum = colTitle) or (colNum = colSubTitle) or (ColNum = ColPastBal) or (Colnum = ColPastBalPc) then
          colNum := colPlanBal;
        if ColNum = colPlanBalpc then
          ColNum := colPlanBal;
        StopEditingState(True);
        calculateSummary(activerow, activecol);
        StartEditingState;
        AllowRedraw := True;
      end;
    ccDown:
      with OvcTable2
      do begin
        AllowRedraw := False;
        if RowNum < Rowlimit -1
        then begin
          StopEditingState(True);
          calculateSummary(activerow, activecol);
          IncRow(RowNum, 1);
          StartEditingState;
        end;
        AllowRedraw := True;
      End;
    ccUp:
      with OvcTable2
      do begin
        AllowRedraw := False;
        if RowNum > 1
        then begin
          StopEditingState(True);
          calculateSummary(activerow, activecol);
          IncRow(RowNum, -1);
          StartEditingState;
        end;
        AllowRedraw := True;
      End;
  end;
end;

procedure TPlanningF.OvcTable1Exit(Sender: TObject);
begin
 OvcTable1.InvalidateTable;
end;

procedure TPlanningF.OvcTable1LeavingRow(Sender: TObject; RowNum: Integer);
begin
  if Rownum < 1 then exit;
end;

procedure TPlanningF.calculateSummary(activerow, activecol : integer);
var
  Accountno : integer;
  tempbal : Currency;
  cn : integer;
begin
  Accountno := TPlanDataRecPtr(PlanDataList.Items[Activerow - 1]).Accountno;
  if activecol = colPastBal then
    begin
    case Accountno of
      SALES:;
      GROSSPROFIT: begin
            tempbal := GetListPastBalance(GetAccountListIndex(COGS));
            if tempbal = 0 then
              begin
              tempbal :=  GetListPastBalance(GetAccountListIndex(SALES)) - TPlanDataRecPtr(PlanDataList.Items[Activerow - 1]).PastBalances[DataModuleClient.DateRangersD_Index.Value - 1];
              setListPastBalance(getAccountListIndex(COGS), tempbal);
              end;
            end;
      COGS: Begin
              tempbal :=  GetListPastBalance(GetAccountListIndex(SALES)) - TPlanDataRecPtr(PlanDataList.Items[Activerow - 1]).PastBalances[DataModuleClient.DateRangersD_Index.value - 1];
              setListPastBalance(getAccountListIndex(GROSSPROFIT), tempbal);
            end;
      TOTALEXPENSES:begin
                    tempbal :=  GetListPastBalance(GetAccountListIndex(GROSSPROFIT)) - TPlanDataRecPtr(PlanDataList.Items[Activerow - 1]).PastBalances[DataModuleClient.DateRangersD_Index.value - 1];
                    setListPastBalance(getAccountListIndex(NETOPERATINGPROFIT), tempbal);

                    End;
      NETOPERATINGPROFIT: begin
            tempbal := GetListPastBalance(GetAccountListIndex(TOTALEXPENSES));
            if tempbal = 0 then
              begin
              tempbal :=  GetListPastBalance(GetAccountListIndex(GROSSPROFIT)) - TPlanDataRecPtr(PlanDataList.Items[Activerow - 1]).PastBalances[DataModuleClient.DateRangersD_Index.value - 1];
              setListPastBalance(getAccountListIndex(TOTALEXPENSES), tempbal);
              end;
            end;
      OTHERINCOME:;
      NETPROFIT: begin
            tempbal := GetListPastBalance(GetAccountListIndex(OTHERINCOME));
            if tempbal = 0 then
              begin
              tempbal :=  TPlanDataRecPtr(PlanDataList.Items[Activerow - 1]).PastBalances[DataModuleClient.DateRangersD_Index.value - 1] - GetListPastBalance(GetAccountListIndex(NETOPERATINGPROFIT));
              setListPastBalance(getAccountListIndex(OTHERINCOME), tempbal);
              end;
            end;
    end;
    // set the main balances
    tempbal := GetListPastBalance(GetAccountListIndex(SALES)) - GetListPastBalance(GetAccountListIndex(COGS));
    setListPastBalance(getAccountListIndex(GROSSPROFIT), tempbal);
    tempbal := tempbal - GetListPastBalance(GetAccountListIndex(TOTALEXPENSES));
    setListPastBalance(getAccountListIndex(NETOPERATINGPROFIT), tempbal);
    tempbal := tempbal + GetListPastBalance(GetAccountListIndex(OTHERINCOME));
    setListPastBalance(getAccountListIndex(NETPROFIT), tempbal);
    // set Percentage to Sales
    cn := 0;
    tempbal := GetListPastBalance(GetAccountListIndex(SALES));
    repeat
      if tempbal <> 0 then
        TPlanDataRecPtr(PlanDataList.Items[cn]).PastResultpc := GetListPastBalance(cn) * 100 / tempbal
      else
        TPlanDataRecPtr(PlanDataList.Items[cn]).PastResultpc := 0;
      inc(cn);
    until  TPlanDataRecPtr(PlanDataList.Items[cn - 1]).accountno = NETPROFIT;
    OvcTable1.InvalidateColumn(colPastBal);
    end
  else if activecol = colPlanBal then
    begin
      case Accountno of
      SALES: begin
            if GetListPlanBalance(GetAccountListIndex(SALES)) = 0 then
              begin
              setListPlanBalance(getAccountListIndex(SALES), 0, True);
              end;
            end;
      COGS:  begin
            if GetListPlanBalance(GetAccountListIndex(COGS)) = 0 then
              begin
              setListPlanBalance(getAccountListIndex(COGS), 0, True);
              end;
            end;
      GROSSPROFIT: begin
            tempbal := GetListPlanBalance(GetAccountListIndex(COGS));
            if (tempbal = 0) and (GetListPlanBalance(GetAccountListIndex(SALES)) <> 0) then
              begin
              tempbal :=  GetListPlanBalance(GetAccountListIndex(SALES)) - TPlanDataRecPtr(PlanDataList.Items[Activerow - 1]).PlanTotal;
              setListPlanBalance(getAccountListIndex(COGS), tempbal, True);
              end;
            end;
      TOTALEXPENSES:;
      NETOPERATINGPROFIT: begin
            tempbal := GetListPlanBalance(GetAccountListIndex(TOTALEXPENSES));
            if tempbal = 0 then
              begin
              tempbal :=  GetListPlanBalance(GetAccountListIndex(GROSSPROFIT)) - TPlanDataRecPtr(PlanDataList.Items[Activerow - 1]).Plantotal;
              setListPlanBalance(getAccountListIndex(TOTALEXPENSES), tempbal, True);
              end;
            end;
      OTHERINCOME:;
      NETPROFIT: begin
            tempbal := GetListPlanBalance(GetAccountListIndex(OTHERINCOME));
            if tempbal = 0 then
              begin
              tempbal :=  TPlanDataRecPtr(PlanDataList.Items[Activerow - 1]).PlanTotal - GetListPlanBalance(GetAccountListIndex(NETOPERATINGPROFIT));
              setListPlanBalance(getAccountListIndex(OTHERINCOME), tempbal, True);
              end;
            end;
      end;
    // set the main balances
      tempbal := GetListPlanBalance(GetAccountListIndex(SALES)) - GetListPlanBalance(GetAccountListIndex(COGS));
      setListPlanBalance(getAccountListIndex(GROSSPROFIT), tempbal, False);
      tempbal := tempbal - GetListPlanBalance(GetAccountListIndex(TOTALEXPENSES));
      setListPlanBalance(getAccountListIndex(NETOPERATINGPROFIT), tempbal, True);
      tempbal := tempbal + GetListPlanBalance(GetAccountListIndex(OTHERINCOME));
      setListPlanBalance(getAccountListIndex(NETPROFIT), tempbal, True);
      // set Percentage to Sales
      cn := 0;
      tempbal := GetListPlanBalance(GetAccountListIndex(SALES));
      repeat
        if tempbal <> 0 then
          TPlanDataRecPtr(PlanDataList.Items[cn]).PlanTotalpc := GetListPlanBalance(cn) * 100 / tempbal
        else
          TPlanDataRecPtr(PlanDataList.Items[cn]).PlanTotalpc := 0;
        inc(cn);
      until  TPlanDataRecPtr(PlanDataList.Items[cn - 1]).accountno = NETPROFIT;
      OvcTable1.InvalidateColumn(colPlanBal);
    end;
end;

procedure TPlanningF.AOvcTCCurrency1KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  rowNum : integer;
begin
  if (key = VK_RETURN)
    then begin
    rownum := OvcTable1.activeRow;
    with OvcTable1
      do begin
      invalidateRow(rownum);
      AllowRedraw := False;
      if RowNum = ActiveRow
        then begin
        StopEditingState(True);
        calculateSummary(activerow, activecol);
        SetActiveCell((RowNum + 1), Activecol);
        StartEditingState;
      end;
      AllowRedraw := True;
      invalidate;
    End;
    key := 0;
  end;
end;

procedure TPlanningF.OvcTable1Enter(Sender: TObject);
begin
CalculateSummary(OvcTable1.ActiveRow, ColPastBal);
CalculateSummary(OvcTable1.ActiveRow, ColPlanBal);
end;

procedure TPlanningF.OvcTable2Enter(Sender: TObject);
begin
CalculateSummary(OvcTable2.ActiveRow, ColPastBal);
CalculateSummary(OvcTable2.ActiveRow, ColPlanBal);
end;

procedure TPlanningF.PlanWizardPage3Enter(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: Enter Page 3');
  Label1.Caption := 'Identifying the Key Activity';
  if DataModuleClient.DepartmentsSingular_UnitDesc.value > ''
    then begin
    AComboBox1.itemindex := AComboBox1.Items.IndexOf(DataModuleClient.DepartmentsSingular_UnitDesc.value);
    if AComboBox1.ItemIndex < 0
      then AComboBox1.itemindex := AComboBox1.items.Add(DataModuleClient.DepartmentsSingular_UnitDesc.value);
  end;
  if DataModuleClient.DepartmentsPlural_UnitDesc.value > ''
    then begin
    AComboBox2.itemindex := AComboBox2.Items.IndexOf(DataModuleClient.DepartmentsPlural_UnitDesc.value);
    if AComboBox2.ItemIndex < 0
      then AComboBox2.itemindex := AComboBox2.items.Add(DataModuleClient.DepartmentsPlural_UnitDesc.value);
  end;
end;

procedure TPlanningF.PlanWizardPage3Exit(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: Exit Page 3');
  SelectedPastDate := DataModuleClient.DateRangersENDDATE.Value;
  DataModuleClient.Departments.edit;
  DataModuleClient.DepartmentsSingular_UnitDesc.value := AComboBox1.Text;
  DataModuleClient.DepartmentsPlural_UnitDesc.value := AComboBox2.Text;
  DataModuleClient.Departments.Post;
  FindpastDate;
  GGlobals.UnitRounding := 2;
  if (DataModuleClient.DepartmentsSingular_UnitDesc.value = 'Sale')
    or (DataModuleClient.DepartmentsSingular_UnitDesc.value = 'Meal')
    or (DataModuleClient.DepartmentsSingular_UnitDesc.value = 'Hire')
    or (DataModuleClient.DepartmentsSingular_UnitDesc.value = 'Customer')
    then GGlobals.UnitRounding := 0;
end;

procedure TPlanningF.setlabels;
var
  Base: Integer;
begin
  Base := 73;
  if (DataModuleClient.DepartmentsSingular_UnitDesc.value = 'Hour') or
    (DataModuleClient.DepartmentsPlural_UnitDesc.value = 'Hours')then
    begin
// This is the default setting but we must ensure that all controls are in the correct order.
    LI.Visible := True;
    Label13.visible := True;
    PastFTEProduction.visible := True;
    PastFTEProduction.TabStop := True;
//    PastFteProduction.CanFocus := True;
    HelpProdFteBtn.Visible := True;
    HelpTotalFteBtn.Visible := True;
    PlanHelpPotentialHoursBtn.Visible := True;
    HelpPotentialUnitsBtn.Visible := False;
    HelpPotentialHoursBtn.Visible := True;
    Label18.Top := Base + 128;
    PastPotUnits.Top := base + 129;
    Label15.Top := Base + 160;
    PastUnitsSold.top := Base + 161;
    Label19.top := Base + 192;
    HoursperdayLbl.Top := Base + 192;
    PastProd.Top := Base + 193;
    Label16.Top := Base + 224;
    PastSaleUnit.Top := Base + 225;
    Label17.top := Base + 256;
    PastGPUnit.top := base + 257;
    PastFteProduction.TabOrder := 1;
    PastPotUnits.TabOrder := 2;
    PastUnitsSold.TabOrder := 3;
    PastProd.TabOrder := 4;
    PastSaleUnit.TabOrder := 5;
    PastGPUnit.tabOrder := 6;

    Label15.Caption := 'Actual ' + DataModuleClient.DepartmentsPlural_UnitDesc.value
      + ' Sold = B / I';
    Label16.Caption := 'Average Sales (Revenue) per ' + DataModuleClient.DepartmentsSingular_UnitDesc.value
      + ' = A / F';
    Label19.Caption := '% Activity Level = F / E';
    Label17.Caption := 'Average Gross Profit (Contribution) per ' + DataModuleClient.DepartmentsSingular_UnitDesc.value + ' = B / F';
    end
  else
    begin
// This is not the default
    LI.Visible := False;
    Label13.visible := False;
    PastFTEProduction.visible := False;
    PastFTEProduction.TabStop := False;
    HelpProdFteBtn.Visible := False;
    HelpPotentialHoursBtn.Visible := False;
    HelpPotentialUnitsBtn.Visible := True;
    Label18.Top := Base + 96;
    PastPotUnits.Top := base + 97;
    Label15.Top := Base + 128;
    PastUnitsSold.top := Base + 129;
    Label19.top := Base + 160;
    HoursperdayLbl.Top := Base + 160;
    PastProd.Top := Base + 161;
    Label16.Top := Base + 192;
    PastSaleUnit.Top := Base + 193;
    Label17.top := Base + 224;
    PastGPUnit.top := base + 225;
    PastPotUnits.TabOrder := 1;
    PastUnitsSold.TabOrder := 2;
    PastProd.TabOrder := 3;
    PastSaleUnit.TabOrder := 4;
    PastGPUnit.tabOrder := 5;
    Label15.Caption := 'Number of ' + DataModuleClient.DepartmentsPlural_UnitDesc.value
      + ' Made or sold = A / G';
    Label16.Caption := 'Average Sales (Revenue) per ' + DataModuleClient.DepartmentsSingular_UnitDesc.value + ' = A / E';
    Label19.Caption := '% Activity Level = E / D';
    Label17.Caption := 'Average Gross Profit (Contribution) per ' + DataModuleClient.DepartmentsSingular_UnitDesc.value + ' = B / E';
    end;
  Label18.Caption := 'Potential ' + DataModuleClient.DepartmentsPlural_UnitDesc.value;
end;

procedure TPlanningF.setlabels1;
var
  Base: Integer;
begin
  Base := 96;
  if (DataModuleClient.DepartmentsSingular_UnitDesc.value = 'Hour') or
    (DataModuleClient.DepartmentsPlural_UnitDesc.value = 'Hours')
    then begin
// This is the default setting but we must ensure that all controls are in the correct order.
    Label42.Visible := True;
    Label46.visible := True;
    PlanFTEProduction.visible := True;
    PastTFTEProduction.visible := True;
    PlanHelpProductionFteBtn.Visible := True;
    PlanHelpPotentialHoursBtn.Visible := True;
    PlanHelpTotalFteBtn.Visible := True;
    PlanHelpPotentialUnitsBtn.Visible := False;
//    PlanGetInvoicesBtn.Visible := True;
//    GetWorkBackBtn.Visible := True;
//    PlanHelpTotalFTEBtn.Top := 200;
    Label45.Top := Base + 128;
    PlanPotUnits.Top := base + 129;
    PastTPotUnits.Top := base + 129;
    Label52.Top := Base + 160;
    PlanBilledUnits.top := Base + 161;
    PastTBilledUnits.top := Base + 161;
    Label48.top := Base + 192;
    PlanProd.Top := Base + 193;
    PastTProd.Top := Base + 193;
    Label53.Top := Base + 224;
    PlanSalesUnit.Top := Base + 225;
    PastTSalesUnit.Top := Base + 225;
    Label55.top := Base + 256;
    PlanGPUnit.top := base + 257;
    PastTGPUnit.top := base + 257;
    PlanFTEProduction.TabStop := True;
    PlanFteProduction.TabOrder := 1;
    PlanPotUnits.TabOrder := 2;
    PlanBilledUnits.TabOrder := 3;
    PlanProd.tabOrder := 4;
    PlanSalesUnit.TabOrder := 5;
    PlanGPUnit.tabOrder := 6;

    Label52.Caption := DataModuleClient.DepartmentsPlural_UnitDesc.value
      + ' Targeted = B / H';
    Label53.Caption := 'Average Sales (Revenue) per ' + DataModuleClient.DepartmentsSingular_UnitDesc.value
      + ' = A / F';
    Label48.Caption := '% Activity Level = F / E';
    Label55.Caption := 'Average Gross Profit (Contribution) per ' + DataModuleClient.DepartmentsSingular_UnitDesc.value + ' = B / F';
  end
  else begin
// This is not the default
    Label42.Visible := False;
    Label46.visible := False;
    PlanFTEProduction.visible := False;
    PastTFTEProduction.visible := False;
    PlanHelpProductionFteBtn.Visible := False;
    PlanHelpPotentialHoursBtn.Visible := False;
    PlanHelpPotentialUnitsBtn.Visible := True;
//    PlanGetInvoicesBtn.Visible := False;
//    PlanHelpTotalFTEBtn.Top := 168;
    Label45.Top := Base + 96;
    PlanPotUnits.Top := base + 97;
    PastTPotUnits.Top := base + 97;
    Label52.Top := Base + 128;
    PlanBilledUnits.top := Base + 129;
    PastTBilledUnits.top := Base + 129;
    Label48.top := Base + 160;
    PlanProd.Top := Base + 161;
    PastTProd.Top := Base + 161;
    Label53.Top := Base + 192;
    PlanSalesUnit.Top := Base + 193;
    PastTSalesUnit.Top := Base + 193;
    Label55.top := Base + 224;
    PlanGPUnit.top := base + 225;
    PastTGPUnit.top := base + 225;
    PlanFTEProduction.TabStop := False;
    PlanPotUnits.TabOrder := 1;
    PlanBilledUnits.TabOrder := 2;
    PlanProd.TabOrder := 3;
    PlanSalesUnit.TabOrder := 4;
    PlanGPUnit.tabOrder := 5;

    Label52.Caption := DataModuleClient.DepartmentsPlural_UnitDesc.value
      + ' Targeted = A / G';
    Label53.Caption := 'Average Sales (Revenue) per ' + DataModuleClient.DepartmentsSingular_UnitDesc.value + ' = A / E';
    Label48.Caption := '% Activity Level = E / D';
    Label55.Caption := 'Average Gross Profit (Contribution) per ' + DataModuleClient.DepartmentsSingular_UnitDesc.value + ' = B / E';
  end;
  Label45.Caption := 'Potential ' + DataModuleClient.DepartmentsPlural_UnitDesc.value;
end;

procedure TPlanningF.ComboBox1KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
  if Key = VK_RETURN then
    begin
    ProcessEnterKey(self, self.taborder + 1);
    key := 0;
    end;
end;

procedure TPlanningF.ComboBox1KeyPress(Sender: TObject; var Key: Char);
begin
  if Key = char(VK_RETURN) then
    begin
    ProcessEnterKey(self, self.taborder + 1);
    key := #0;
    end;
end;

procedure TPlanningF.PlanWizardPage3KeyPress(Sender: TObject;
  var Key: Char);
begin
//inherited;
if key = char(VK_RETURN) then
  key := #0;
end;

procedure TPlanningF.FormKeyPress(Sender: TObject; var Key: Char);
begin
if PlanningF.ActiveControl.Name = 'OvcTable3' then
  begin
  if Key = char(VK_RETURN) then
    key := char(VK_TAB);
  end;
end;

procedure TPlanningF.AComboBox1KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
if key = VK_RETURN then
  key := 0;
end;

procedure TPlanningF.AComboBox1KeyPress(Sender: TObject; var Key: Char);
begin
if key = char(VK_RETURN) then
  key := #0;
end;

procedure TPlanningF.AComboBox1KeyUp(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
if key = VK_RETURN then
  key := 0;
end;

procedure TPlanningF.PlanFTEKeyPress(Sender: TObject; var Key: Char);
begin
  if Key = char(VK_RETURN) then
    begin
    key := #0;
    end;
  inherited;
end;

// Used by PlanGPUnit
procedure TPlanningF.PlanFTEKeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
  if Key = VK_RETURN then
    begin
    ProcessEnterKey(PlanningF.PlanFTE, 0);
    key := 0;
    end;
end;

procedure TPlanningF.fcShapeBtn1Click(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: Past Expenses');
  OvcTable1.AllowRedraw := False;
  DetailedExpensesPast := True;
  screen.Cursor := crHourGlass;
  Application.CreateForm(TDIYPlanExpensesF, DIYPlanExpensesF);
  DIYPlanExpensesF.Showmodal;
  DIYPlanExpensesF.free;
  OvcTable1.StopEditingState(False);
  calculateSummary(4, colPlanbal);
  OvcTable1.StartEditingState;
  OvcTable1.AllowRedraw := True;
end;

procedure TPlanningF.PlanningStartDateExit(Sender: TObject);
begin
  SelectedPastDate := DataModuleClient.DateRangersENDDATE.Value;
  if (DataModuleClient.DepartmentsFirstPlanDate.value > 0)
    and (CompareDateTime(DataModuleClient.DepartmentsCurrentPlanStart.value, DataModuleClient.DepartmentsFirstPlanDate.value) < 0) then
    begin
    DataModuleClient.Departments.edit;
    DataModuleClient.DepartmentsCurrentPlanStart.value := DataModuleClient.DepartmentsFirstPlanDate.value;
    DataModuleClient.Departments.Post;
    MessageDlg('Plan Start date can not be before ' + DataModuleClient.DepartmentsFirstPlanDate.asstring + #13#10 + 'To plan before this date, you must clear this plan and reentry data', mtInformation, [mbOK], 0);
    end;
  if (DataModuleClient.DepartmentsCurrentPlanEnd.value = 0) or
    (DaySpan(DataModuleClient.DepartmentsCurrentPlanEnd.value, DataModuleClient.DepartmentsCurrentPlanStart.value) > 366) then
    begin
    DataModuleClient.Departments.edit;
    DataModuleClient.DepartmentsCurrentPlanEnd.value := IncYear(DataModuleClient.DepartmentsCurrentPlanStart.value) - 1;
    DataModuleClient.Departments.Post;
    end;
  if (InitialPlanend <> DataModuleClient.DepartmentsCurrentPlanEnd.value) or (InitialPlanStart <> DataModuleClient.DepartmentsCurrentPlanStart.value) then
    PlanExtBtn.Enabled := True;
  if (DataModuleClient.DepartmentsFirstPlanDate.value > 0)
    and (CompareDateTime(DataModuleClient.DepartmentsCurrentPlanStart.value, DataModuleClient.DepartmentsCurrentPlanEnd.value) >= 0) then
    begin
    MessageDlg('Plan End date can not be before the the Start Date = ' + DataModuleClient.DepartmentsCurrentPlanStart.asstring + #13#10 + 'A suggested End Date has been made. Please edit if necessary.', mtInformation, [mbOK], 0);
    DataModuleClient.Departments.edit;
    DataModuleClient.DepartmentsCurrentPlanEnd.value := IncYear(DataModuleClient.DepartmentsCurrentPlanStart.value, 1) - 1;
    DataModuleClient.Departments.Post;
    end;
  DataModuleClient.ClientDatabase.Refresh(true);
  FindPastDate;
end;

procedure TPlanningF.PlanningWizardCancelClick(Sender: TObject);
begin
  Ovctable1.StopEditingState(true);
  Ovctable1.StartEditingState;
  OvcTable1.AllowRedraw := False;
  // Ask if you wish to save the data.

  if (MessageDlg('Do you wish to save the changes to the data you have just entered?',mtinformation,[mbYes, mbNo], 0) = mrOK) and (DataCollect.Planloaded = True) then
    begin
    screen.Cursor := crHourGlass;
    DataCollect.setPlanningData;
    end;
  DataCollect.ClearPlanDataList;
  DataCollect.ClearPlanExpDataList;
  DataCollect.ClearConsolidatedList;
  Close;
end;

procedure TPlanningF.getpastactivitybalances;
var
  Hoursmins : Currency;
begin
  ActivityPastSales.Value := getListPastBalance(getaccountlistindex(SALES));
  ActivityPastGP.Value := getListPastBalance(getaccountlistindex(GROSSPROFIT));
  PastunitsSold.Value := getListPastBalance(getaccountlistindex(BILLED));
  PastPotunits.Value := getListPastBalance(getaccountlistindex(POTENTIAL));
  PastFTEProduction.Value := getListPastBalance(getaccountlistindex(FTEPROD));
  PastFTE.Value := getListPastBalance(getaccountlistindex(FTEOTHER));
  if PastUnitsSold.value <> 0 then
    begin
    PastSaleUnit.value := ActivityPastSales.value / PastUnitsSold.value;
    PastGPUnit.value := ActivityPastGP.value / PastUnitsSold.value;
    end;
  if (PastPotUnits.Value <> 0) and (PastUnitsSold.value <> 0) then
    PastProd.value := PastUnitsSold.value  * 100 / PastPotUnits.value
  else
    PastProd.value := 0;
  if (PastProd.value > 0) then
    begin
    Hoursmins := PastUnitsSold.value  * 8 / PastPotUnits.value;
    HoursperdayLbl.caption := '= ' + inttostr(trunc(hoursmins)) + 'hr ' + inttostr(trunc(Hoursmins * 60) mod 60) + 'mins';
    end;

  if PastFte.Value <> 0 then
    begin
    PastSalesFTE.Value := ActivityPastSales.Value / PastFTE.Value;
    PastGPFTE.Value := ActivityPastGP.Value / PastFTE.Value;
    end;
end;

procedure TPlanningF.getplanactivitybalances;
begin
  ActivityPastTSales.Value := getListPastBalance(getaccountlistindex(SALES));
  ActivityPastTGP.Value := getListPastBalance(getaccountlistindex(GROSSPROFIT));
  PastTPotunits.Value := getListPastBalance(getaccountlistindex(POTENTIAL));
  PastTBilledunits.Value := getListPastBalance(getaccountlistindex(BILLED));
  ActivityPlanSales.Value := getListPlanBalance(getaccountlistindex(SALES));
  ActivityPlanGP.Value := getListPlanBalance(getaccountlistindex(GROSSPROFIT));
  PlanPotunits.Value := getListPlanBalance(getaccountlistindex(POTENTIAL));
  PlanBilledunits.Value := getListPlanBalance(getaccountlistindex(BILLED));
//  PlanFTEProduction.Value := getListPastBalance(getaccountlistindex(FTEPROD));

  PastTFTE.Value := getListPastBalance(getaccountlistindex(FTEOTHER));
  PastTFTEProduction.Value := getListPastBalance(getaccountlistindex(FTEPROD));
  PastTSalesFTE.Value := 0;
  PastTGPFTE.Value := 0;
  PlanFTE.Value := getListPlanBalance(getaccountlistindex(FTEOTHER));
  PlanFTEProduction.Value := getListPlanBalance(getaccountlistindex(FTEPROD));
  PlanSalesFTE.Value := 0;
  PlanGPFTE.Value := 0;
  if PastTFTE.value <> 0 then
    begin
    PastTSalesFTE.Value := ActivityPastTSales.Value / PastTFTE.Value;
    PastTGPFTE.Value := ActivityPastTGP.Value / PastTFTE.Value;
    end;
  if PlanFTE.value <> 0 then
    begin
    PlanSalesFTE.Value := ActivityPlanSales.Value / PlanFTE.Value;
    PlanGPFTE.Value := ActivityPlanGP.Value / PlanFTE.Value;
    end;
  if PastTBilledUnits.value <> 0 then
    begin
    PastTSalesUnit.value := ActivityPastTSales.value / PastTBilledUnits.value;
    PastTGPUnit.value := ActivityPastTGP.value / PastTBilledUnits.value;
    end;
  if (PastTPotUnits.Value <> 0) and (PastTBilledUnits.value <> 0) then
    PastTProd.value := PastTBilledUnits.value  * 100 / PastTPotUnits.value;
end;

procedure TPlanningF.setplanactivitybalances;
var
  TempCurr: Currency;
begin
  TempCurr := getListPlanBalance(getaccountlistindex(SALES));
  SetListPlanBalance(getaccountlistindex(SALES), tempCurr, True);
  TempCurr := getListPlanBalance(getaccountlistindex(GROSSPROFIT));
  SetListPlanBalance(getaccountlistindex(GROSSPROFIT), tempCurr, True);
  TempCurr := getListPlanBalance(getaccountlistindex(OTHERINCOME));
  SetListPlanBalance(getaccountlistindex(OTHERINCOME), tempCurr, True);

  SetListPlanBalance(getaccountlistindex(POTENTIAL), PlanPotUnits.Value, True);
  SetListPlanBalance(getaccountlistindex(BILLED), PlanBilledUnits.Value, True);
  setListPlanBalance(getaccountlistindex(FTEOTHER), PlanFTE.Value, True);
  setListPlanBalance(getaccountlistindex(FTEPROD), PlanFTEProduction.Value, True);
  CalcNetProfit;
end;

procedure TPlanningF.CalcNetProfit;
var
  daysinyear: integer;
  j: integer;
  TCOGS, TNOP, TNP : currency;
  PlanSalesDataRec : TPlanDataRecPtr;
  PlanCogsDataRec : TPlanDataRecPtr;
  PlanGPDataRec : TPlanDataRecPtr;
  PlanExpDataRec : TPlanDataRecPtr;
  PlanNOPDataRec : TPlanDataRecPtr;
  PlanOtherDataRec : TPlanDataRecPtr;
  PlanNPDataRec : TPlanDataRecPtr;
begin
  PlanSalesDataRec := PlanDataList.Items[GetAccountListIndex(SALES)];
  PlanCogsDataRec := PlanDataList.Items[GetAccountListIndex(COGS)];
  PlanGPDataRec := PlanDataList.Items[GetAccountListIndex(GROSSPROFIT)];
  PlanExpDataRec := PlanDataList.Items[GetAccountListIndex(TOTALEXPENSES)];
  PlanNOPDataRec := PlanDataList.Items[GetAccountListIndex(NETOPERATINGPROFIT)];
  PlanOtherDataRec := PlanDataList.Items[GetAccountListIndex(OTHERINCOME)];
  PlanNPDataRec := PlanDataList.Items[GetAccountListIndex(NETPROFIT)];

  daysinyear := trunc(DataModuleClient.DepartmentsCurrentPlanEnd.value) - trunc(DataModuleClient.DepartmentsCurrentPlanStart.value);
  TCOGS := 0;
  TNOP := 0;
  TNP := 0;
  for j := 0 to daysinyear do    // Iterate
    begin
    PlanCogsDataRec.PlanDetail[j] := PlanSalesDataRec.PlanDetail[j] - PlanGPDataRec.PlanDetail[j];
    TCOGS := TCOGS + PlanCogsDataRec.PlanDetail[j];
    PlanNOPDataRec.PlanDetail[j] := PlanGPDataRec.PlanDetail[j] - PlanExpDataRec.PlanDetail[j];
    TNOP := TNOP + PlanNopDataRec.PlanDetail[j];
    PlanNPDataRec.PlanDetail[j] := PlanNOPDataRec.PlanDetail[j] + PlanOtherDataRec.PlanDetail[j];
    TNP := TNP + PlanNPDataRec.PlanDetail[j];
    PlanCogsDataRec.PlanTotal := TCOGS;
    PlanNOPDataRec.PlanTotal := TNOP;
    PlanNPDataRec.PlanTotal := TNP;
    end;    // for
end;

procedure TPlanningF.setpastactivitybalances;
begin
  setListPastBalance(getaccountlistindex(BILLED), PastUnitsSold.Value);
  setListPastBalance(getaccountlistindex(POTENTIAL), PastPotUnits.value);
  setListPastBalance(getaccountlistindex(FTEPROD), PastFTEProduction.Value);
  setListPastBalance(getaccountlistindex(FTEOTHER), PastFTE.Value);
end;

procedure TPlanningF.CalculatePastActivity(accountno : integer);
var
  Hoursmins : Currency;
begin
  case accountno of    //
    SALES: begin
      if PastUnitsSold.value <> 0
        then begin
        PastSaleUnit.value := ActivityPastSales.value / PastUnitsSold.value;
        PastGPUnit.value := ActivityPastGP.value / PastUnitsSold.value;
      end;
      end;
    BILLED: begin
      if PastGPUnit.value <> 0 then
        PastUnitsSold.Value := ActivityPastGP.value / PastGPUnit.value;
      if GGlobals.UnitRounding = 0
        then begin
        PastUnitsSold.Value := round(PastUnitsSold.value);
        PastPotUnits.Value := round(PastPotUnits.value);
      end;
      CalculatePastActivity(SALES);
      end;
    POTENTIAL: ;
    PRODUCTIVITY: begin
      if PastProd.value <> 0 then
        PastUnitsSold.value := PastPotUnits.value * PastProd.value / 100;
      if GGlobals.UnitRounding = 0
        then begin
        PastUnitsSold.Value := round(PastUnitsSold.value);
        PastPotUnits.Value := round(PastPotUnits.value);
      end;
      CalculatePastActivity(SALES);
      end;
  end;    // case
  HoursperdayLbl.caption := '';
  if (PastPotUnits.Value <> 0) and (PastUnitsSold.value <> 0) then
    PastProd.value := PastUnitsSold.value  * 100 / PastPotUnits.value
  else
    PastProd.value := 0;
  if (PastProd.value > 0) //and (PastProd.value < 75)
    then begin
    Hoursmins := PastUnitsSold.value  * 8 / PastPotUnits.value;
    HoursperdayLbl.caption := '= ' + inttostr(trunc(hoursmins)) + 'hr ' + inttostr(trunc(Hoursmins * 60) mod 60) + 'mins';
  end;
end;

procedure TPlanningF.PastGPUnitExit(Sender: TObject);
begin
  CalculatePastActivity(BILLED);
  PastFte.SetFocus;
end;

procedure TPlanningF.PastUnitsSoldExit(Sender: TObject);
begin
  if GGlobals.UnitRounding = 0 then PastUnitsSold.Value := round(PastUnitsSold.value);
  CalculatePastActivity(SALES);
end;

procedure TPlanningF.PastSaleUnitExit(Sender: TObject);
begin
 if PastSaleUnit.value <> 0
   then PastUnitsSold.value := ActivityPastSales.Value / PastSaleUnit.value;
 CalculatePastActivity(SALES);
end;

procedure TPlanningF.CalculatePlanActivity(accountno : integer);
var
  Hoursmins : Currency;
begin
  case accountno of    //
    SALES:
      begin
      if PlanBilledUnits.value <> 0 then
        begin
        PlanSalesUnit.value := ActivityPlanSales.value / PlanBilledUnits.value;
        PlanGPUnit.value := ActivityPlanGP.value / PlanBilledUnits.value;
        end;
      end;
    BILLED:
      begin
      if PlanGPUnit.value <> 0 then
        PlanBilledUnits.Value := ActivityPlanGP.value / PlanGPUnit.value;
      if GGlobals.UnitRounding = 0 then
        begin
        PlanBilledUnits.Value := Round(PlanBilledUnits.Value);
        PlanPotUnits.Value := Round(PlanPotUnits.Value);
        end;
      CalculatePlanActivity(SALES);
      end;
    POTENTIAL:
      begin
      if (PlanPotUnits.value <> 0) and (PlanProd.value <> 0) then
        PlanBilledUnits.value := PlanPotUnits.value * PlanProd.Value / 100;
      end;
    PRODUCTIVITY:
      Begin
      if PlanProd.value <> 0 then
        PlanBilledUnits.value := PlanProd.value * PlanPotUnits.value / 100;
      if GGlobals.UnitRounding = 0 then
        begin
        PlanBilledUnits.Value := Round(PlanBilledUnits.Value);
        PlanPotUnits.Value := Round(PlanPotUnits.Value);
        end;
      CalculatePlanActivity(SALES);
      end;
  end;    // case
  HoursProdLbl2.caption := '';
  if (PlanPotUnits.Value <> 0) and (PlanBilledUnits.value <> 0) then
    PlanProd.value := PlanBilledUnits.value  * 100 / PlanPotUnits.value
  else
    PlanProd.value := 0;
  if (PlanProd.value > 0) //and (PlanProd.value < 75)
    then begin
    Hoursmins := PlanBilledUnits.value  * 8 / PlanPotUnits.value;
    HoursProdLbl2.caption := '= ' + inttostr(trunc(hoursmins)) + 'hr ' + inttostr(trunc(Hoursmins * 60) mod 60) + 'mins';
  end;
end;

procedure TPlanningF.PlanGPUnitEnter(Sender: TObject);
begin
  if (PlanGPUnit.value = 0) and (PastGPUnit.value <> 0) then
    PlanGPUnit.Value := PastGPUnit.value;
end;

procedure TPlanningF.PlanGPUnitExit(Sender: TObject);
begin
  if PlanBilledUnits.Value <> 0 then
    ActivityPlanGP.value := PlanBilledUnits.Value * PlanGPUnit.Value;
   CalculatePlanActivity(BILLED);
  PlanFte.SetFocus;
end;

procedure TPlanningF.PlanUnitsSoldExit(Sender: TObject);
begin
  if GGlobals.UnitRounding = 0 then PlanBilledUnits.value := round(PlanBilledUnits.value);
  CalculatePlanActivity(SALES);
end;

procedure TPlanningF.PlanProdExit(Sender: TObject);
begin
  CalculatePlanActivity(PRODUCTIVITY);
end;

procedure TPlanningF.GetInvoicesBtnClick(Sender: TObject);
begin
  OvcTable1.AllowRedraw := False;
  if HelpInvoiceRate > 0 then
    PastGPUnit.Value := HelpInvoiceRate;
  CalculatePastActivity(BILLED);
  OvcTable1.AllowRedraw := True;
end;

procedure TPlanningF.GetWorkBackBtnClick(Sender: TObject);
begin
  OvcTable1.AllowRedraw := False;
  OvcTable1.AllowRedraw := True;
end;

procedure TPlanningF.PlanningWizardChange(Sender: TObject);
begin
//  CurrentIndex := PlanningWizard.ActivePage.PageIndex;
  if Not PageChanging then
    PageChanging := True;
  Initialised := False;
end;

procedure TPlanningF.fcShapeBtn4Click(Sender: TObject);
var
  PlanDataRec : TPlanDataRecPtr;
  idx : Integer;
begin
{
  GGlobals.DebugOut('Plan: Plan Expenses');
  OvcTable2.AllowRedraw := False;
  Screen.Cursor := crHourGlass;
  OvcTable2.StopEditingState(True);
  DetailedExpensesPast := False;
  PlanDataRec := PlanDataList.Items[GetAccountListIndex(TOTALEXPENSES)];
  TargetExpTotal := PlanDataRec.PlanTotal;
  Application.CreateForm(TDIYPlanExpensesF, DIYPlanExpensesF);
  DIYPlanExpensesF.Showmodal;
  DIYPlanExpensesF.free;
  calculateSummary(4, colPlanbal);
  OvcTable2.StartEditingState;
  OvcTable2.AllowRedraw := True;
}
  GGlobals.DebugOut('Plan: Plan Expenses');
  OvcTable2.AllowRedraw := False;
  Screen.Cursor := crHourGlass;
  OvcTable2.StopEditingState(True);
  DetailedExpensesPast := False;
  PlanDataRec := PlanDataList.Items[GetAccountListIndex(TOTALEXPENSES)];
  TargetExpTotal := PlanDataRec.PlanTotal;
  Application.CreateForm(TDetailExpensesF, DetailExpensesF);
  DataCollect.GetDetailedOptions;
  Idx := strtoint(currtostr(DataCollect.detailedOptions[43]));
  if (idx < 4) or (Idx > 6) then
    idx := 4;
  DetailExpensesF.RGIndex.ItemIndex := idx;
  DetailExpensesF.SetCheckedAccount(0);
  DetailExpensesF.ShowModal;
  if DetailExpensesF.RGIndex.ItemIndex < 0 then
    DetailExpensesF.RGIndex.ItemIndex := 0;
  DataCollect.detailedOptions[43] := DetailExpensesF.RGIndex.ItemIndex;
  DetailExpensesF.Free;
  DataCollect.SetDetailedOptions;
  calculateSummary(4, colPlanbal);
  OvcTable2.StartEditingState;
  OvcTable2.AllowRedraw := True;
  screen.Cursor := crDefault;
end;

// Used by PastGPUnit
procedure TPlanningF.PastFTEKeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
  if Key = VK_RETURN
    then begin
    ProcessEnterKey(PlanningF.PastFTE, 0);
    key := 0;
  end;
  inherited;
end;

procedure TPlanningF.PastFTEExit(Sender: TObject);
begin
  if PastFTE.Value <> 0 then
    begin
    PastSalesFTE.Value := ActivityPastSales.Value / PastFTE.Value;
    PastGPFTE.Value := ActivityPastGP.Value / PastFTE.Value;
    end;
end;


procedure TPlanningF.PlanWizardPage6Enter(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: Enter Page 6');
  Label1.Caption := 'Targeting Activity and Contribution';
  fcLabel2.Caption := DataModuleClient.DepartmentsCurrentPlanStart.DisplayText + ' to ' +
    DataModuleClient.DepartmentsCurrentPlanEnd.DisplayText;
  setlabels1;
  if DataModuleClient.DateRangersStartDate.value <> 0 then
    begin
    SetPastDateLabels;
    label71.visible := True;
    fcLabel7.visible := True;
    ActivityPastTSales.visible := True;
    ActivityPastTGP.visible := True;
    PastTFTE.visible := True;
    PastTFteProduction.visible := True;
    PastTPotUnits.visible := True;
    PastTBilledUnits.visible := True;
    PastTSalesUnit.visible := True;
    PastTGPUnit.visible := True;
    PastTProd.visible := True;
    PastTSalesFTE.Visible := True;
    PastTGPFTE.Visible := True;
    end
  else
    begin
    label71.visible := False;
    fcLabel7.visible := False;
    ActivityPastTSales.visible := False;
    ActivityPastTGP.visible := False;
    PastTFTE.visible := False;
    PastTFteProduction.visible := False;
    PastTPotUnits.visible := False;
    PastTBilledUnits.visible := False;
    PastTSalesUnit.visible := False;
    PastTGPUnit.visible := False;
    PastTProd.visible := False;
    PastTSalesFTE.Visible := False;
    PastTGPFTE.Visible := False;
    end;
  getplanactivitybalances;
  calculatePlanActivity(SALES);
end;

procedure TPlanningF.PlanWizardPage6Exit(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: Exit Page 6');
  setPlanActivityBalances;
end;

procedure TPlanningF.PlanFTEExit(Sender: TObject);
begin
  PlanSalesFTE.Value := 0;
  PlanGPFTE.Value := 0;
  if PlanFTE.Value <> 0
    then begin
    PlanSalesFTE.Value := ActivityPlanSales.Value / PlanFTE.Value;
    PlanGPFTE.Value := ActivityPlanGP.Value / PlanFTE.Value;
  end;
end;

procedure TPlanningF.PlanBilledUnitsKeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
  if Key = VK_RETURN then
    begin

    if AcomboBox2.items[ACombobox2.itemindex] = 'Hours' then
      ProcessEnterKey(PlanningF.PlanSalesUnit, 0)
    else
      ProcessEnterKey(PlanningF.PlanFTE, 0);
    key := 0;
    end;
  inherited;
end;

procedure TPlanningF.PlanSalesUnitExit(Sender: TObject);
var
  fGPPC : Currency;
begin
  if ActivityPlanSales.Value <> 0 then
    fGPPC := ActivityPlanGP.value * 100 / ActivityPlanSales.Value
  else
    fGPPC := 0;
  if PlanSalesUnit.Value <> 0
    then begin
    ActivityPlanSales.value := PlanSalesUnit.Value * PlanBilledUnits.Value;
    if fGPPC <> 0 then
      ActivityPlanGP.value := ActivityPlanSales.Value * fGPPC / 100;
    CalculatePlanActivity(SALES);
  end;
end;

procedure TPlanningF.setlabels2;
begin
  Label60.Caption := 'Gross Profit';
  Label63.Caption := 'Sales per ' + AComboBox1.Items[AComboBox1.Itemindex];
  Label62.Caption := 'Gross Profit per ' + AComboBox1.Items[AComboBox1.Itemindex];
  Label64.Caption := 'Billed ' + AComboBox2.Items[AComboBox2.Itemindex];
  Label65.Caption := 'Potential ' + AComboBox2.Items[AComboBox2.Itemindex];
  Label66.Caption := 'Activity Level (Productivity %)';

  if AcomboBox2.items[ACombobox2.itemindex] = 'Hours'
    then begin
    Label65.Caption := 'Potential ' + AComboBox2.Items[AComboBox2.Itemindex] + ' available to be sold';
  end;
end;

procedure TPlanningF.PlanWizardPage7Exit(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: Exit Page 7');
  DetailedIndex := 0;
end;

procedure TPlanningF.PlanWizardPage7Enter(Sender: TObject);
var
  j: Integer;
begin
  GGlobals.DebugOut('Plan: Enter Page 7');
  Label1.Caption := 'Targeting - What If Scenarios';
//  fcLabel2.Caption := DataModuleClient.DepartmentsCurrentPlanStart.DisplayText + ' to ' +
//    DataModuleClient.DepartmentsCurrentPlanEnd.DisplayText;
  setlabels2;

  // if we have a past balance use it
  WIScenTotalExp.Value := round(getListPlanBalance(getaccountlistindex(TOTALEXPENSES)));
  if WIScenTotalExp.Value = 0 then
    WIScenTotalExp.Value := round(getListPastBalance(getaccountlistindex(TOTALEXPENSES)));

  WIBaseTotalExp.Value := WIScenTotalExp.value;

  RGSales.CaptionStyle := csNormal;
  RGScene.CaptionStyle := csNormal;
  RGBase.CaptionStyle := csNormal;
  if DataModuleClient.DateRangersStartDate.value <> 0
    then begin
    RGBase.ItemIndex := 0;
    fcImageBtn3.Visible := True;
  end
  else begin
    RGBase.ItemIndex := 1;
    fcImageBtn3.Visible := False;
  end;
  // get and Set Base Balances
  getbase;
  // Set Scenario 1,2,3 from base if no balances exist.
  for j := 1 to 3 do    // Iterate
    begin
    if GetWIBalance(j, WISales) = 0
      then begin
      SetWIBalance(J, WISales, GetWIBalance(WIBase, WISALES));
      SetWIBalance(J, WIGP, GetWIBalance(WIBase, WIGP));
      SetWIBalance(J, WIPOTENTIAL, GetWIBalance(WIBase, WIPOTENTIAL));
      SetWIBalance(J, WIBILLED, GetWIBalance(WIBase, WIBILLED));
    end;
  end;    // for
  // Set the Current Scenario
  CurrentScene := 1;
  RGScene.ItemIndex := CurrentScene - 1;
  // calculate results
  WhatIfCalc(WISALES);
end;

procedure TPlanningF.WhatIfCalc(Account : integer);
var
  j: integer;
  TempBal: Currency;
  HoursMins : Currency;
  Laccount: Integer;
begin
  WhatIfUpdate := False;
  Laccount := Account;
  //
  if account > WIPROD  // A Percentage change has occurred
    then begin
    if GetWIBalance(CurrentScene, Account) <> 0 then
      SetWIBalance(CurrentScene, Account - 10, GetWIBalance(WIBase, Account - 10) * (getWIBalance(CurrentScene, Account) + 100) / 100)
    else
      SetWIBalance(CurrentScene, Account - 10, GetWIBalance(WIBase, Account - 10));
    Laccount := Account - 10;
  end;
  // Use Laccount ONLY from now on
  if (Laccount = WIPOTENTIAL) or (Laccount = WIPROD)
    then begin
    if (GetWIbalance(CurrentScene, WIPotential) <> 0) and (GetWIBalance(CurrentScene, WIPROD) <> 0)
      then begin
      SetWIBalance(CurrentScene, WIBILLED, GetWIBalance(CurrentScene, WIPOTENTIAL) * GetWIBalance(CurrentScene, WIPROD) / 100);
      If GGlobals.unitRounding = 0
        then begin
        SetWIBalance(CurrentScene, WIBILLED, round(GetWIBalance(CurrentScene, WIBILLED)));
        SetWIBalance(CurrentScene, WIPOTENTIAL, round(GetWIBalance(CurrentScene, WIPOTENTIAL)));
      end;
    end;
    if GetWIbalance(CurrentScene, WIPotential) = 0 then
      SetWIBalance(CurrentScene, WIPROD, 0);
    Laccount := WIGPU; // fall through to GPU
  end;
  // store the value of COGS
  TempBal := GetWIBalance(CurrentScene, WISALES) - GetWIBalance(CurrentScene, WIGP);
  if (Laccount = WIGPU) or (Laccount = WIBILLED)
    then begin
    SetWIBalance(CurrentScene, WIGP, GetWIBalance(CurrentScene, WIBILLED) * GetWIBalance(CurrentScene, WIGPU));
    if (Laccount = WIBilled) or (RGSales.Itemindex = 1)
      then begin
      if GetWIBalance(CurrentScene, WIGPPC) <> 0 then
        SetWIBalance(CurrentScene, WISales, GetWIBalance(CurrentScene, WIGP) * 100 / GetWIBalance(CurrentScene, WIGPPC));
    end
    else begin
      SetWIBalance(CurrentScene, WISales, GetWIBalance(CurrentScene, WIGP) + tempbal);
      if GetWIBalance(CurrentScene, WISales) <> 0 then
        SetWIBalance(CurrentScene, WIGPPC, GetWIBalance(CurrentScene, WIGP) * 100 / GetWIBalance(CurrentScene, WISales));
    end;
  end;
  if Laccount = WISU
    then begin
    SetWIBalance(CurrentScene, WISales, GetWIBalance(CurrentScene, WIBILLED) * GetWIBalance(CurrentScene, WISU));
    if (RGSales.Itemindex = 1) then
      SetWIBalance(CurrentScene, WIGP, GetWIBalance(CurrentScene, WISALES) * GetWIBalance(CurrentScene, WIGPPC) / 100)
    else begin
      SetWIBalance(CurrentScene, WIGP, GetWIBalance(CurrentScene, WISales) - tempbal);
      if GetWIBalance(CurrentScene, WISales) <> 0 then
        SetWIBalance(CurrentScene, WIGPPC, GetWIBalance(CurrentScene, WIGP) * 100 / GetWIBalance(CurrentScene, WISales));
    end;
  end;
  if Laccount = WIGPPC
    then begin
    if (RGSales.Itemindex = 1)
      then begin
      if GetWIBalance(CurrentScene, WIGPPC) <> 0 then
        SetWIBalance(CurrentScene, WISales, GetWIBalance(CurrentScene, WIGP) * 100 / GetWIBalance(CurrentScene, WIGPPC));
    end
    else
      SetWIBalance(CurrentScene, WIGP, GetWIBalance(CurrentScene, WISALES) * GetWIBalance(CurrentScene, WIGPPC) / 100);
  end;
  // Calculate 4 ratios
  if GetWIBalance(CurrentScene, WISales) <> 0 then
    SetWIBalance(CurrentScene, WIGPPC, GetWIBalance(CurrentScene, WIGP) * 100 / GetWIBalance(CurrentScene, WISales));
  if GetWIBalance(CurrentScene, WIBilled) <> 0 then
    SetWIBalance(CurrentScene, WISU, GetWIBalance(CurrentScene, WISales) / GetWIBalance(CurrentScene, WIBilled));
  if GetWIBalance(CurrentScene, WIBilled) <> 0 then
    SetWIBalance(CurrentScene, WIGPU, GetWIBalance(CurrentScene, WIGP) / GetWIBalance(CurrentScene, WIBilled));
  if GetWIBalance(CurrentScene, WIPotential) <> 0 then
    SetWIBalance(CurrentScene, WIPROD, GetWIBalance(CurrentScene, WIBilled) * 100 / GetWIBalance(CurrentScene, WIPotential));

  WIScenSales.value := Round(GetWIBalance(CurrentScene, WISales));
  WIScenGP.Value := round(GetWIBalance(CurrentScene, WIGP));
  WIScenPotential.Value := GetWIBalance(CurrentScene, WIPotential);

  WIScenBilled.Value := GetWIBalance(CurrentScene, WIBilled);

  WIScenGPPC.Value := getWIBalance(CurrentScene, WIGPPC);
  WIScenSalesUnit.Value := getWIBalance(CurrentScene, WISU);
  WIScenGPUnit.Value := getWIBalance(CurrentScene, WIGPU);
  WIScenProductivity.Value := getWIBalance(CurrentScene, WIPROD);
  if (WIScenProductivity.value > 0) and (WIScenProductivity.value < 100)
    then begin
    Hoursmins := 8 * WIScenProductivity.value / 100;
    HourspdLblWI.caption := 'Productive Hours per day = ' + inttostr(trunc(hoursmins)) + 'hr ' + inttostr(trunc(Hoursmins * 60) mod 60) + 'mins';
  end
  else
    HourspdLblWI.Caption := '';
  WIScenNetProfit.Value := round(GetWIBalance(CurrentScene, WIGP)) - WIScenTotalExp.Value;
  // Calculculate pc change
  for j := 10 to 17 do    // Iterate
  begin
    if getWIBalance(WIBase, j - 10) <> 0 then
      SetWIBalance(CurrentScene, J, (GetWIBalance(CurrentScene, j - 10) * 100 / GetWIBalance(WIBase, J - 10)) - 100)
    else
      SetWIBalance(CurrentScene, J, 0);
  end;
      // for
  WIChangeSales.value := GetWIBalance(CurrentScene, WISalesPCI);
  WIChangeGP.Value := GetWIBalance(CurrentScene, WIGPPCI);
  WIChangePotential.Value := GetWIBalance(CurrentScene, WIPotentialPCI);
  WIChangeBilled.Value := GetWIBalance(CurrentScene, WIBilledPCI);

  WIChangeGPPC.Value := getWIBalance(CurrentScene, WIGPPCPCI);
  WIChangeSalesUnit.Value := getWIBalance(CurrentScene, WISUPCI);
  WIChangeGPUnit.Value := getWIBalance(CurrentScene, WIGPUPCI);
  WIChangeProductivity.Value := getWIBalance(CurrentScene, WIPRODPCI);
  WhatIfUpdate := True;
end;

procedure TPlanningF.RGBaseClick(Sender: TObject);
begin
  getbase;
  WhatIfCalc(WISALES);
end;

procedure TPlanningF.WIScenGPPCChange(Sender: TObject);
begin
  if WhatifUpdate
    then begin
    SetWIBalance(CurrentScene, WIGPPC, WIScenGPPC.value);
    WhatIfCalc(WIGPPC);
  End;
end;

procedure TPlanningF.WIScenSalesUnitChange(Sender: TObject);
begin
  if WhatifUpdate
    then begin
    SetWIBalance(CurrentScene, WISU, WIScenSalesUnit.value);
    WhatIfCalc(WISU);
  End;
end;

procedure TPlanningF.WIScenGPUnitChange(Sender: TObject);
begin
  if WhatifUpdate
    then begin
    SetWIBalance(CurrentScene, WIGPU, WIScenGPUnit.value);
    WhatIfCalc(WIGPU);
  End;
end;

procedure TPlanningF.WIScenBilledChange(Sender: TObject);
begin
  if WhatifUpdate
    then begin
    if GGlobals.UnitRounding = 0 then WIScenBilled.value := round(WIScenBilled.value);
    SetWIBalance(CurrentScene, WIBilled, WIScenBilled.value);
    WhatIfCalc(WIBilled);
  End;
end;

procedure TPlanningF.WIScenPotentialChange(Sender: TObject);
begin
  if WhatifUpdate then
    begin
    if GGlobals.UnitRounding = 0 then WIScenPotential.value := round(WIScenPotential.value);
    SetWIBalance(CurrentScene, WIPOTENTIAL, WIScenPotential.value);
    WhatIfCalc(WIPOTENTIAL);
    End;
end;

procedure TPlanningF.WIScenProductivityChange(Sender: TObject);
begin
  if WhatifUpdate then
    begin
    SetWIBalance(CurrentScene, WIPROD, WIScenProductivity.value);
    WhatIfCalc(WIPROD);
    End;
end;

procedure TPlanningF.WIChangeGPPCChange(Sender: TObject);
begin
  if WhatifUpdate then
    begin
    SetWIBalance(CurrentScene, WIGPPCPCI, WIChangeGPPC.value);
    WhatIfCalc(WIGPPCPCI);
    End;
end;

procedure TPlanningF.WIChangeSalesUnitChange(Sender: TObject);
begin
  if WhatifUpdate then
    begin
    SetWIBalance(CurrentScene, WISUPCI, WIChangeSalesUnit.value);
    WhatIfCalc(WISUPCI);
    End;
end;

procedure TPlanningF.WIChangeGPUnitChange(Sender: TObject);
begin
  if WhatifUpdate then
    begin
    SetWIBalance(CurrentScene, WIGPUPCI, WIChangeGPUnit.value);
    WhatIfCalc(WIGPUPCI);
    End;
end;

procedure TPlanningF.WIChangeBilledChange(Sender: TObject);
begin
  if WhatifUpdate then
    begin
    SetWIBalance(CurrentScene, WIBilledPCI, WIChangeBilled.value);
    WhatIfCalc(WIBilledPCI);
    End;
end;

procedure TPlanningF.WIChangePotentialChange(Sender: TObject);
begin
  if WhatifUpdate then
    begin
    SetWIBalance(CurrentScene, WIPOTENTIALPCI, WIChangePotential.value);
    WhatIfCalc(WIPOTENTIALPCI);
    End;
end;

procedure TPlanningF.WIChangeProductivityChange(Sender: TObject);
begin
  if WhatifUpdate then
    begin
    SetWIBalance(CurrentScene, WIPRODPCI, WIChangeProductivity.value);
    WhatIfCalc(WIPRODPCI);
    End;
end;

procedure TPlanningF.fcImageBtn1Click(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: WI Reset');
  SetWIBalance(CurrentScene, WISales, GetWIBalance(WIBase, WISALES));
  SetWIBalance(CurrentScene, WIGP, GetWIBalance(WIBase, WIGP));
  SetWIBalance(CurrentScene, WIPOTENTIAL, GetWIBalance(WIBase, WIPOTENTIAL));
  SetWIBalance(CurrentScene, WIBILLED, GetWIBalance(WIBase, WIBILLED));
  WhatIfCalc(WISALES);
end;

procedure TPlanningF.fcImageBtn2Click(Sender: TObject);
begin
  GGlobals.DebugOut('Plan: WIªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªªª